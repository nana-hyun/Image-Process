# Regis Transformation model (Spatial transformation model)

강체 변환(rigid-body) 모델부터 투영(perspective) 모델까지 다양한 선형모델들을 다룰 예정.

모든 선형 공간 변환 모델은 행렬 표기로 표현가능. 공간 변환모델의 형식 매개변수와 상응하는 행렬이 요소사이의 관계에 대해 다룸.

# Homogenous Coordinates

동차 좌표

2차원 선형 변환은 3 x 3 행렬로 표현 가능하며, 3차원 선형 변환은 4 x 4 행렬로 표현 가능하다.

2차원 좌표 (x, y)는 벡터 ![image](https://user-images.githubusercontent.com/101063108/159187752-d1cdb20d-3e4d-4ec9-b0e9-055f5501fba5.png)
로 할당 되며,

3차원 좌표 (x, y, z)는 벡터 ![image](https://user-images.githubusercontent.com/101063108/159187775-2500a1c0-84e7-428e-9a9d-e7117e345368.png)
로 할당된다.

여분의 마지막 요소는 placeholder로 수학적 작업을 적절하게 해주고 투영 변환에서의 의미있는 기하학적 해석이 가능하다.

행렬 연산이 1단위 이외의 0이 아닌 값으로 끝나는 벡터를 생성하는 경우, 전체 벡터는 스칼라 값으로 리스케일링 할 수 있고, 그렇다면 이는 동차좌표로 해석될 수 있다.

![image](https://user-images.githubusercontent.com/101063108/159187884-df85cb27-dcd0-45a8-8a92-c6989c947797.png)

rescale

![image](https://user-images.githubusercontent.com/101063108/159187894-4c686a4a-8ea4-4da4-8238-f0dde92e995e.png)

(a/k, b/k, c/k) 좌표에 상응하는 것으로 해석

0으로 끝나는 벡터라면 이 방법으로 rescale할 수 없다.

0으로 끝난다는 말은 동차 좌표 위치라고 볼 수 없다는 것과 같다.

![image](https://user-images.githubusercontent.com/101063108/159187963-9055d26e-aae3-46f0-bd85-aa3feec54d21.png)

이는 원점에서 점 (i, j, k)까지 지나는 벡터, 즉 방향을 나타내는 벡터라고 볼 수 있다.

위의 방법을 이용해서, 좌표 (x, y)에서 새로운 좌표 (x`, y`)으로의 2차원 선형 변환은 다음과 같이 쓸 수 있다.

![image](https://user-images.githubusercontent.com/101063108/159188050-0fb3d111-2af9-4d01-bf85-15bf91de0284.png)

위의 방법을 이용해서, 좌표 (x, y, z)에서 새로운 좌표 (x`, y`, z`)으로의 3차원 선형 변환은 다음과 같이 쓸 수 있다.

![image](https://user-images.githubusercontent.com/101063108/159188073-b3195100-adb3-4b07-9226-973c63aec33b.png)

왼쪽 위의 2x2나 3x3의 소행렬의 행렬식이  0보다 커야한다.

# 2. Rigid-Body Model

의료 영상에서 가장 제약된 공간 변환 모델이 바로 강체 모델이다.

강체 모델은 registration 하는 동안 거리와 내부각이 변하지 않는다.

실제 세계에서 물제가 강체로 동작하고, 전역(global) 회전과 변형에 민감하지만 내부적으로는 불변한다고 가정한다.

변형되지 않는 뼈같은 개체에 적합하다. 뿐만 아니라 뇌는 변형으로 이어지는 힘으로부터 보호가능한 뼈에 둘러싸여 있기 때문에, 뇌에도 적용이 가능하다.

그러나 뇌간(brainstem)과 같은 뇌의 일부가 심장주기, 호흡주기에 의해 유발되는 왜곡에 종속되어 있어 근사치로만 볼 수 있다.

많은 심장과 호흡주기로부터 얻어진 영상에서 이러한 움직입은 강체의 가정을 잘 따르는 흐릿하지만 매우 일관된 신호를 만들 수 있지만, 매우 짧은 시간 프레임으로부터 얻어진 영상에서
강체모델 가정의 명백한 위반을 초래한다.

의료 영상들은 x축, y축, z축을 따라 표시되는 실제거리가 다른 복셀들로 구성이 된다.

강체 모델의 시행은 실제 거리와 각도가 변경되지 않으며 복셀크기를 명시적으로 보정한다.

worst case 시나리오 : 6개의 다른 복셀크기를 가질때.

적절히 시행하기 위해서는 이러한 복셀 크기 중 하나를 고르거나 임의로 다른 복셀크기를 선택해야한다.

그러나 계산은 다양한 복셀크기를 보정하기 위해 거리를 rescale 하는 것을 포함해야한다.

따라서 6개의 복셀 크기를 정확히 알아야한다.

만약에 정확히 알지 못한다면, 복셀크기의 specification 오류는 registration에서 불필요한 오류를 야기하고, 
가장 좋은 전략은 알려진 크기를 가진 phantom을 스캔하여 진짜 복셀크기를 계산해야한다.

이것이 불가능하다면, 강체모델을 늘리기 위해 추가적인 매개변수의 추가로 오류를 추정할 수 있다.

## 2.1. Two Dimensional Case

2차원 강체 변환은 2개의 매개변수가 주요 측을 따라 변형하고, 세번재 매개변수는  원점에 대한 회전을 의미한다.

(x,y)에서 (x`,y`)로의 기본 변환에 의한 변형은 다음과 같이 작성할 수 있다.

![image](https://user-images.githubusercontent.com/101063108/159189277-1f972cbb-583c-4851-8cbe-ba4b4f563774.png)

p, g, θ는 매개변수

x축은 오른쪽이 양의 값을 갖는 수평선이고, y축은 위쪽이 양의 값을 갖는 수직선.

양의 θ는 시계방향 회전을 한다.

양의 θ가 반시계방향 회전을 한다면 sinθ를 포함하는 두 용어의 부호는 반대가 된다.

동차좌표 행렬로의 표현

![image](https://user-images.githubusercontent.com/101063108/159189409-777edb26-0e1f-4797-805b-1b1e2a85c61a.png)

이럼에도 2차원 강체 변환이라고 말하기에 모호하다.

두가지의 합리적인 순서가 있다.

(1)  회전 전에 변환을 적용하는 경우, (2) 변환 전에 회전을 적용하는 경우

![image](https://user-images.githubusercontent.com/101063108/159189498-c1c3bbf1-b03d-4848-bce2-fc236c4427d2.png)

서로 다른 순서의 결과는 같지 않다. 뿐만 아니라 세개의 독립 매개변수는 6개의 가변 요소를 따라 분산되지 않는다.

세번째 열의 두 변수는 임의의 값을 가질 수 있으며 왼쪽 위의 2x2 하위 행렬의 요수 모두 회전각도 θ의 함수로 구속된다.

예를 들어, 시계방향으로 10° 회전하고 x를 따라 4단위, y를 따라 7단위를 변환한다고 하자.

그렇다면 행렬을 다음과 같이 쓸 수 있다.

![image](https://user-images.githubusercontent.com/101063108/159189740-f0a589ee-367c-4b48-a746-db69679bc111.png)

변형이 회전 전에 적용된다면, 회전의 크기와 방향은 바뀌지 않지만, x를 따라 2.3764단위로, y를 따라 9.5579단위로 바뀌어 진행하게 된다.

![image](https://user-images.githubusercontent.com/101063108/159189826-2d50f449-e468-4648-9605-a8f4aee109fc.png)

이는 Fig. 1에 잘 나와있다.

![image](https://user-images.githubusercontent.com/101063108/159189839-adc70a81-3a6f-406a-bc66-e66abaa82ca3.png)

